{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg rounded">
        <div class="card-body">
            <h2 class="text-center mb-4"><i class="fas fa-file-alt"></i> Detalles de la Solicitud</h2>
            <ul class="list-group">
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-calendar-alt"></i> Fecha de Solicitud:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.fecha_solicitud }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-user"></i> Operador:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.operador }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-phone-alt"></i> Teléfono:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.telefono }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-clock"></i> Turno:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.turno }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-calendar-day"></i> Fecha de Recogida:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.fecha_recogida }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-map-marked-alt"></i> Localidad:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.localidad }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-city"></i> Barrio:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.barrio }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-map-marker-alt"></i> Ubicación:</div>
                        <div class="col-md-8"><a href="{{ solicitud.ubicacion }}" class="btn btn-link" target="_blank">Ver Ubicación</a></div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-road"></i> Ruta:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.ruta }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-home"></i> Dirección:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.direccion }}</div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-info-circle"></i> Estado de la solicitud:</div>
                        <div class="col-md-8">
                            {% if solicitud.estado.id == 1 %}
                                <span class="badge bg-success"><i class="fas fa-check-circle"></i> Activa</span>
                            {% elif solicitud.estado.id == 2 %}
                                <span class="badge bg-danger"><i class="fas fa-exclamation-circle"></i> Cancelada</span>
                            {% else %}
                                <span class="badge bg-secondary"><i class="fas fa-times-circle"></i> Finalizada</span>
                            {% endif %}
                        </div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-md-4 fw-bold"><i class="fas fa-user-circle"></i> Usuario:</div>
                        <div class="col-md-8 text-muted">{{ solicitud.usuario }}</div>
                    </div>
                </li>
            </ul>

            <!-- Botones de acción -->
            <div class="text-center mt-4">
                <a href="{% url 'lista_solicitudes' %}" class="btn btn-outline-dark">
                    <i class="fas fa-arrow-left"></i> Cerrar
                </a>

                {% if not grupo_operaciones and not grupo_view_operaciones %}
                <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                        data-bs-target="#cancelModal" {% if not solicitud.estado.id == 1 %}disabled{% endif %}>
                    {% if solicitud.estado.id == 2 %}
                        <i class="fas fa-ban"></i> Ruta Cancelada
                    {% elif solicitud.estado.id == 1 %}
                        <i class="fas fa-ban"></i> Cancelar Ruta
                    {% endif %}
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelModalLabel"><i class="fas fa-exclamation-triangle"></i> Confirmar Cancelación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="cancelar-form" method="POST" action="{% url 'cancelar_solicitud' solicitud.id %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Motivo de cancelación</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="3" required></textarea>
                    </div>
                    <input type="hidden" name="fecha_cancelacion" id="fecha_cancelacion">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="submit" class="btn btn-danger" form="cancelar-form"><i class="fas fa-check"></i> Confirmar Cancelación</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}